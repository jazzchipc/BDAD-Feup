CREATE TABLE Pessoa(
idPessoa 		INT NOT NULL PRIMARY KEY,
nome			CHAR(20) NOT NULL,
idade			INT NOT NULL,
sexo			CHAR(20) NOT NULL,
morada			VARCHAR(50),
NIF			INT NOT NULL,
UNIQUE NIF);

CREATE TABLE Utente(
numeroUtente		INT NOT NULL PRIMARY KEY,
idPessoa		INT NOT NULL,
FOREIGN KEY (idPessoa) REFERENCES Pessoa(idPessoa));

CREATE TABLE Funcionario(
numeroFuncionario	INT NOT NULL PRIMARY KEY,
idPessoa		INT NOT NULL, 
funcao			VARCHAR(50) NOT NULL,
idEquipa 		INT,
FOREIGN KEY (idPessoa) REFERENCES Pessoa(idPessoa),
FOREIGN KEY (idEquipa) REFERENCES EquipaUrgencia(idEquipa));

CREATE TABLE Medico(
numeroFuncionario	INT NOT NULL PRIMARY KEY,
idEspecialidade 	INT NOT NULL,
areaAcao		VARCHAR(50) NOT NULL,
FOREIGN KEY (numeroFuncionario) REFERENCES Funcionario(numeroFuncionario),
FOREIGN KEY (idEspecialidade) REFERENCES Especialidade(idEspecialidade));

CREATE TABLE Alergia(
idAlergia		INT NOT NULL PRIMARY KEY,
nome 			VARCHAR(50) NOT NULL);

CREATE TABLE Vacina(
idVacina 		INT NOT NULL PRIMARY KEY, 
nome 			VARCHAR(50) NOT NULL,
dataAplicacao		DATE);

CREATE TABLE Especialidade(
idEspecialidade		INT NOT NULL PRIMARY KEY, 
designacao		VARCHAR(50));

CREATE TABLE SalaCirurgica(
idSalaCirurgica	INT NOT NULL PRIMARY KEY,
bloco		CHAR(20) NOT NULL,
numero		INT NOT NULL);

CREATE TABLE UtenteAlergia(
idAlergia	INT NOT NULL REFERENCES Alergia(idAlergia),
numeroUtente 	INT NOT NULL REFERENCES Utente(numeroUtente), 
PRIMARY KEY(idAlergia, numeroUtente));

CREATE TABLE UtenteVacina(
idVacina	INT NOT NULL REFERENCES Vacina(idVacina),
numeroUtente 	INT NOT NULL REFERENCES Utente(numeroUtente),
PRIMARY KEY(idVacina, numeroUtente));

CREATE TABLE EquipaUrgencia(
idEquipa INT NOT NULL PRIMARY KEY,
dataInicio DATE NOT NULL,
dataFim DATE,
idLider	INT NOT NULL,
FOREIGN KEY (idLider) REFERENCES Medico(idLider));

CREATE TABLE Inscricao
(urgenciaID NUMBER PRIMARY_KEY NOT NULL,
numeroUtente NUMBER REFERENCES Utente(numeroUtente) NOT NULL,
numeroFuncionario NUMBER REFERENCES Funcionario(númeroFuncionario) NOT NULL,
horaEntrada INTEGER NOT NULL);

CREATE TABLE Checkout
(urgenciaID NUMBER PRIMARY_KEY NOT NULL,
numeroUtente NUMBER REFERENCES Utente(numeroUtente) NOT NULL,
numeroFuncionario NUMBER REFERENCES Funcionario(númeroFuncionario) NOT NULL,
taxa NUMBER NOT NULL,
dataSaida INTEGER NOT NULL);

CREATE TABLE Triagem
(urgenciaID NUMBER PRIMARY KEY NOT NULL,
numeroUtente NUMBER REFERENCES Utente(numeroUtente) NOT NULL,
numeroFuncionario NUMBER REFERENCES Funcionario(númeroFuncionario) NOT NULL,
areaAcao TEXT NOT NULL,
prioridade TEXT NOT NULL);

CREATE TABLE Diagnostico
(urgenciaID NUMBER NOT NULL,
numeroUtente NUMBER REFERENCES Utente(numeroUtente) NOT NULL,
númeroFuncionario NUMBER REFERENCES Funcionario(numeroFuncionario) NOT NULL,
dataEntrada INTEGER NOT NULL,
dataSaida INTEGER,
PRIMARY KEY(urgenciaID, dataEntrada, dataSaida),
CHECK (dataSaida > dataEntrada)); 

CREATE TABLE Tratamento
(urgenciaID NUMBER PRIMARY KEY NOT NULL,
numeroUtente NUMBER REFERENCES Utente(numeroUtente) NOT NULL,
numeroFuncionário NUMBER REFERENCES Funcionario(númeroFuncionario) NOT NULL);

CREATE TABLE Cirurgia(
urgenciaID	INT NOT NULL PRIMARY KEY REFERENCES Tratamento(urgenciaID),
codigo 		INT NOT NULL UNIQUE,
areaAcao	TEXT NOT NULL,
idSalaCirurgica INT NOT NULL UNIQUE REFERENCES SalaCirurgica(idSalaCirurgica);

CREATE TABLE Prescricao(
urgenciaID	INT NOT NULL PRIMARY KEY REFERENCES Tratamento(urgenciaID),
referencia 	INT NOT NULL,
nome		CHAR(20) NOT NULL);