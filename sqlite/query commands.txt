1. Qual é a especialidade do médico chamado "Fábio"? (FEITOOOOOOO!)

SELECT designacao
FROM
	(Pessoa 
	INNER JOIN
	Funcionario
	ON Pessoa.idPessoa = Funcionario.idPessoa
	INNER JOIN
	Medico
	ON Funcionario.numeroFuncionario = Medico.numeroFuncionario
	INNER JOIN
	Especialidade
	ON Medico.idEspecialidade = Especialidade.idEspecialidade)
WHERE Pessoa.nome = 'Fábio';

2. Qual é o conjunto de IDs dos utentes do sexo masculino com idade inferior a 30 anos que foram às urgência entre o dia 22 e 26 de Abril de 2016? (FEITOOOOOOO!)

SELECT DISTINCT Utente.numeroUtente
FROM
	(Pessoa
	INNER JOIN 
	Utente
	ON Pessoa.idPessoa = Utente.idPessoa
	INNER JOIN
	Inscricao
	ON Utente.numeroUtente = Inscricao.numeroUtente)
WHERE 
((Inscricao.horaEntrada >= '2016-04-22' AND Inscricao.horaEntrada <= '2016-04-26')
AND
(Pessoa.sexo == 'Masculino' AND Pessoa.idade < 30))
ORDER BY Utente.numeroUtente;

3. Quais são os números dos utentes que foram atendidos pelo médico "Duque" ou que têm a vacina contra o "Tetanto"? (FEITOOOOOOO!)

SELECT DISTINCT Utente.numeroUtente
FROM
	(Pessoa
	INNER JOIN
	Funcionario
	ON Pessoa.idPessoa = Funcionario.idPessoa
	INNER JOIN
	Tratamento
	ON Tratamento.numeroFuncionario = Funcionario.numeroFuncionario
	INNER JOIN
	Utente
	ON Utente.numeroUtente = Tratamento.numeroUtente)
WHERE Pessoa.nome = 'Duque'

UNION

SELECT Utente.numeroUtente
FROM
	(Utente
	INNER JOIN
	UtenteVacina
	ON Utente.numeroUtente = UtenteVacina.numeroUtente
	INNER JOIN
	Vacina
	ON Vacina.idVacina = UtenteVacina.idVacina
	)
WHERE Vacina.nome = 'Tetano';

4. Quantas pessoas já tomaram a vacina contra o "Tetano"? (FEITOOOOOOO)

SELECT COUNT(*) numeroUtente FROM UtenteVacina
INNER JOIN Vacina
ON Vacina.idVacina=UtenteVacina.idVacina
WHERE Vacina.nome='Tetano';


5. Quais os IDs dos médicos de área de ação "Cirurgica" que estiveram na equipa de urgência ativa no dia 23 de Abril de 2016?

SELECT numeroFuncionario FROM Medico
INNER JOIN EquipaUrgencia
ON(EquipaUrgencia.dataInicio<='27-04-2016' AND EquipaUrgencia.dataFim >='27-04-2016')
WHERE Medico.areaAcao='Cirurgica';


6. Quais os IDs dos utentes cuja triagem resultou num nível de prioridade "emergente" ou "muito urgente"?

SELECT numeroUtente FROM Triagem
WHERE(Triagem.prioridade='emergente'
      OR
      Triagem.prioridade='muitoUrgente');


7. Quais os nomes, idades e sexo dos utentes que ficaram mais do que 1 dia nas urgências?

SELECT DISTINCT nome, idade, sexo
FROM
	(Pessoa
	INNER JOIN
	Utente
	ON Pessoa.idPessoa = Utente.idPessoa
	INNER JOIN
	Inscricao
	ON Utente.numeroUtente = Inscricao.numeroUtente
	INNER JOIN
	Checkout
	ON Utente.numeroUtente = Checkout.numeroUtente)
GROUP BY Pessoa.nome
HAVING (julianday(Checkout.dataSaida) - julianday(Inscricao.horaEntrada) > 1);





8. Quais os numeroFuncionario dos funcionarios que participaram na equipa com urgênciaID=1?


SELECT numeroFuncionario FROM Funcionario 
WHERE idEquipa=1;

9. Qual o ID do médico que realizou mais cirurgias?

10. Qual o nome e a idade do 1º e 2º utente mais velhos que foram às urgências e qual o ID dos médicos que os atenderam?

SELECT Pessoa.nome, MAX(Pessoa.idade), Tratamento.numeroFuncionario
FROM 	
	(Tratamento
	LEFT JOIN
	Utente
	ON Tratamento.numeroUtente = Utente.numeroUtente
	LEFT JOIN
	Pessoa
	ON Pessoa.idPessoa = Utente.idPessoa)

UNION

SELECT Pessoa.nome, MAX(Pessoa.idade), Tratamento.numeroFuncionario
FROM 	
	(Tratamento
	LEFT JOIN
	Utente
	ON Tratamento.numeroUtente = Utente.numeroUtente
	LEFT JOIN
	Pessoa
	ON Pessoa.idPessoa = Utente.idPessoa)
WHERE (Pessoa.idade < 
		(SELECT MAX(Pessoa.idade)
		FROM
			(Tratamento
			LEFT JOIN
			Utente
			ON Tratamento.numeroUtente = Utente.numeroUtente
			LEFT JOIN
			Pessoa
			ON Pessoa.idPessoa = Utente.idPessoa)));
			
11. Quantas pessoas registadas no sistema não são médicas?

SELECT COUNT(*) idPessoa
FROM
	(Pessoa
	LEFT JOIN
	Funcionario
	ON Pessoa.idPessoa = Funcionario.idPessoa
	LEFT JOIN
	Medico
	ON Funcionario.numeroFuncionario = Medico.numeroFuncionario)
WHERE Medico.numeroFuncionario IS NULL;
	